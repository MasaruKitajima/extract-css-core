<div align="center">
	<h1>extract-css-core</h1>
	<p>Extract all CSS from a given url, both server side and client side rendered.</p>
</div>

[![NPM Version](https://img.shields.io/npm/v/extract-css-core.svg)](https://www.npmjs.com/package/extract-css-core)
[![Weekly downloads](https://img.shields.io/npm/dw/extract-css-core.svg)](https://www.npmjs.com/package/extract-css-core)
[![Build Status](https://travis-ci.org/bartveneman/extract-css-core.svg?branch=master)](https://travis-ci.org/bartveneman/extract-css-core)
[![Known Vulnerabilities](https://snyk.io/test/github/bartveneman/extract-css-core/badge.svg)](https://snyk.io/test/github/bartveneman/extract-css-core)
![Dependencies Status](https://img.shields.io/david/bartveneman/extract-css-core.svg)
![Dependencies Status](https://img.shields.io/david/dev/bartveneman/extract-css-core.svg)
[![XO code style](https://img.shields.io/badge/code_style-XO-5ed9c7.svg)](https://github.com/sindresorhus/xo)
[![Project: Wallace](https://img.shields.io/badge/Project-Wallace-29c87d.svg)](https://www.projectwallace.com/oss)

## Problem, solution and shortcomings

### Problem

Existing packages like
[get-css](https://github.com/cssstats/cssstats/tree/master/packages/get-css)
look at a server-generated piece of HTML and get all the `<link>` and `<style>`
tags from it. This works fine for 100% server rendered pages, but apps that
employ style injection with JavaScript will not be covered.

### Solution

This module uses an instance of Chromium to render a page. This has the benefit
that most of the styles can be rendered, even when generated by JavaScript. The
[Puppeteer CSSCoverage API](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#coveragestartcsscoverageoptions)
is the power behind finding most of the CSS.

### Shortcomings

Currently, there is no solution to get the CSS from modules that use
[Styled Components](https://www.styled-components.com) or something similar. Any
help resolving this issue will be very much appreciated. Please contribute to
the relevant
[GitHub issue](https://github.com/bartveneman/extract-css-core/issues/1).

## Installation

```sh
npm install extract-css-core

# Or with Yarn
yarn add extract-css-core
```

## Usage

```js
const extractCss = require('extract-css-core')

extractCss('http://www.projectwallace.com').then(css => console.log(css))
```

## API

### extractCss(url, [options])

Extract CSS from a page. Returns a Promise that contains the CSS as a single
String.

### Options

Type: `Object`

Default: `null`

#### debug

Type: `Boolean`

Default: `false`

Set to `true` if you want a Chromium window to open as it works to get all the
CSS from the page.

#### waitUntil

Type: `String`

Default: `networkidle2`

Can be any value as provided by the
[Puppeteer docs](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagegotourl-options).

#### browserOverride

Type: `Object`

Default: `null`

An object consisting of the following fields:

- `executablePath`: the path to a Chromium binary
- `puppeteer`: a Puppeteer instance
- `args`: arguments to start Chromium with

See the `test` directory for implementation examples. This option exists
primarily for use with [extract-css.now.sh](https://extract-css.now.sh)

## Related

- [extract-css lambda](https://github.com/bartveneman/extract-css) - Extract CSS
  running as a serverless function
- [get-css](https://github.com/cssstats/cssstats/tree/master/packages/get-css) -
  The original get-css
